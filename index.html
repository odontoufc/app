<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guia Clínico - Odontologia</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>

    <!-- Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: '#0e7490', 
                        secondary: '#155e75', 
                        accent: '#ecfeff',
                        paper: '#ffffff',
                    },
                    screens: { 'xs': '375px' }
                }
            }
        }
    </script>

    <style>
        html { scroll-behavior: smooth; background-color: #f3f4f6; } 
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .btn-card { transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }
        .btn-card:active { transform: scale(0.98); }
        @media (hover: hover) {
            .btn-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #0e7490; }
        }

        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeInView 0.3s ease; }
        @keyframes fadeInView { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Tabs Dinâmicas */
        .tab-scroll { overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
        .tab-btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1rem; color: #6b7280; font-weight: 600; font-size: 0.875rem; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab-btn:hover { color: #0e7490; }
        .tab-btn.active { color: #0e7490; border-bottom-color: #0e7490; background-color: #ecfeff; }
        
        .spinner { border: 3px solid rgba(0,0,0,0.1); border-left-color: #0e7490; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Editor & Content Styles */
        .editor-paper {
            background: white; min-height: 29.7cm; padding: 2.5cm 2cm; margin: 0 auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); outline: none; color: #333; line-height: 1.6; font-size: 11pt;
            font-family: 'Inter', sans-serif !important; 
        }
        .editor-paper * { font-family: 'Inter', sans-serif !important; color: #374151 !important; background-color: transparent !important; font-size: inherit !important; }
        .editor-paper b, .editor-paper strong { font-weight: 700 !important; color: #155e75 !important; }
        .editor-paper i, .editor-paper em { font-style: italic !important; }
        .editor-paper h1, .rich-text h1 { font-size: 1.8em !important; font-weight: 700 !important; margin-top: 1em; color: #111827 !important; }
        .editor-paper h2, .rich-text h2 { font-size: 1.4em !important; font-weight: 700 !important; margin-top: 1em; color: #1f2937 !important; }
        
        @media (max-width: 640px) { .editor-paper { padding: 1.5rem; min-height: 60vh; } }

        .editor-toolbar { position: sticky; top: 0; z-index: 40; background: #f3f4f6; border-bottom: 1px solid #e5e7eb; padding: 0.5rem; display: flex; gap: 0.25rem; flex-wrap: wrap; align-items: center; }
        .toolbar-btn { padding: 0.4rem; border-radius: 0.25rem; color: #4b5563; transition: background 0.2s; display: flex; align-items: center; justify-content: center; min-width: 32px; min-height: 32px; }
        .toolbar-btn:hover { background-color: #e5e7eb; color: #111827; }
        
        .rich-text ul, .editor-paper ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .rich-text ol, .editor-paper ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1em; }
        .rich-text li, .editor-paper li { margin-bottom: 0.25em; }
        .rich-text ul ul, .editor-paper ul ul { list-style-type: circle; margin-top: 0.25em; margin-bottom: 0.25em; }
        .rich-text ol ol, .editor-paper ol ol { list-style-type: lower-alpha; margin-top: 0.25em; margin-bottom: 0.25em; }
        
        [contenteditable]:empty:before { content: attr(placeholder); color: #9ca3af; cursor: text; display: block; }
        
        .tooth { border: 1px solid #e2e8f0; border-radius: 4px; padding: 2px; display: flex; align-items: center; justify-content: center; background: white; font-size: 0.7rem; width: 28px; height: 28px; flex-shrink: 0; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen text-base antialiased">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50 w-full">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer active:opacity-70 transition-opacity" onclick="navigateTo('home')">
                <div class="bg-primary/10 p-2 rounded-lg text-primary">
                    <i data-lucide="book-open-check" class="w-5 h-5"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-gray-900 tracking-tight leading-tight">Guia Clínico</h1>
                    <p class="text-[10px] text-gray-500 font-medium leading-none">Odontologia UFC</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <span id="admin-badge" class="hidden px-2 py-1 bg-red-100 text-red-700 text-[10px] font-bold uppercase rounded-full tracking-wider border border-red-200">Admin</span>
                <button id="back-btn" onclick="navigateTo('home')" class="hidden bg-gray-100 hover:bg-gray-200 text-gray-700 py-1.5 px-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-1 active:scale-95">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    <span class="hidden xs:inline">Voltar</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full max-w-5xl mx-auto px-4 sm:px-6 py-6 pb-20">

        <!-- ================= VIEW: HOME ================= -->
        <div id="view-home" class="view-section active space-y-8">
            <div class="text-center space-y-2 mb-2">
                <h2 class="text-2xl xs:text-3xl font-bold text-gray-900">Bem-vindo</h2>
                <p class="text-sm xs:text-base text-gray-600 max-w-2xl mx-auto">Selecione uma especialidade ou recurso abaixo.</p>
            </div>

            <!-- Blog -->
            <section>
                <div onclick="navigateTo('blog')" class="btn-card bg-gradient-to-r from-primary to-secondary p-6 rounded-2xl shadow-lg cursor-pointer text-white relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                    <div class="flex items-center gap-4 relative z-10">
                        <div class="bg-white/20 p-4 rounded-xl backdrop-blur-sm"><i data-lucide="library" class="w-8 h-8 text-white"></i></div>
                        <div><h3 class="text-xl font-bold mb-1">Protocolos Clínicos</h3><p class="text-cyan-100 text-sm">Base de dados completa.</p></div>
                        <i data-lucide="arrow-right" class="w-6 h-6 ml-auto text-white/70 group-hover:text-white group-hover:translate-x-1 transition-all"></i>
                    </div>
                </div>
            </section>

            <!-- Especialidades (Agora abrem página dinâmica) -->
            <section>
                <div class="flex items-center gap-2 mb-4 border-b border-gray-200 pb-2">
                    <i data-lucide="layout-grid" class="w-5 h-5 text-primary"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Especialidades</h3>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 xs:gap-4">
                    <button onclick="openDynamicPage('dentistica', 'Dentística')" class="btn-card bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center justify-center gap-3 cursor-pointer w-full text-center h-36 xs:h-44">
                        <div class="bg-blue-50 p-3 rounded-full"><i data-lucide="sparkles" class="w-6 h-6 xs:w-8 xs:h-8 text-primary"></i></div>
                        <span class="font-semibold text-sm xs:text-base text-gray-700">Dentística</span>
                    </button>
                    <button onclick="openDynamicPage('periodontia', 'Periodontia')" class="btn-card bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center justify-center gap-3 cursor-pointer w-full text-center h-36 xs:h-44">
                        <div class="bg-red-50 p-3 rounded-full"><i data-lucide="layers" class="w-6 h-6 xs:w-8 xs:h-8 text-rose-600"></i></div>
                        <span class="font-semibold text-sm xs:text-base text-gray-700">Periodontia</span>
                    </button>
                    <button onclick="openDynamicPage('endodontia', 'Endodontia')" class="btn-card bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center justify-center gap-3 cursor-pointer w-full text-center h-36 xs:h-44">
                        <div class="bg-indigo-50 p-3 rounded-full"><i data-lucide="arrow-down-to-line" class="w-6 h-6 xs:w-8 xs:h-8 text-indigo-600"></i></div>
                        <span class="font-semibold text-sm xs:text-base text-gray-700">Endodontia</span>
                    </button>
                    <button onclick="openDynamicPage('cirurgia', 'Cirurgia')" class="btn-card bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center justify-center gap-3 cursor-pointer w-full text-center h-36 xs:h-44">
                        <div class="bg-emerald-50 p-3 rounded-full"><i data-lucide="scissors" class="w-6 h-6 xs:w-8 xs:h-8 text-emerald-600"></i></div>
                        <span class="font-semibold text-sm xs:text-base text-gray-700">Cirurgia</span>
                    </button>
                </div>
            </section>

            <!-- Outros (Agora abrem página dinâmica) -->
            <section>
                <div class="flex items-center gap-2 mb-4 border-b border-gray-200 pb-2">
                    <i data-lucide="package-plus" class="w-5 h-5 text-primary"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Recursos</h3>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <button onclick="openDynamicPage('prescricoes', 'Prescrições')" class="btn-card bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex items-center gap-4 w-full text-left active:bg-gray-50">
                        <div class="bg-amber-50 p-3 rounded-lg shrink-0"><i data-lucide="scroll-text" class="w-6 h-6 text-amber-600"></i></div>
                        <div><span class="block font-semibold text-gray-700">Prescrições</span><span class="text-xs text-gray-500">Modelos e posologias</span></div>
                    </button>
                    <button onclick="openDynamicPage('links', 'Links Úteis')" class="btn-card bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex items-center gap-4 w-full text-left active:bg-gray-50">
                        <div class="bg-gray-100 p-3 rounded-lg shrink-0"><i data-lucide="link" class="w-6 h-6 text-gray-600"></i></div>
                        <div><span class="block font-semibold text-gray-700">Links Úteis</span><span class="text-xs text-gray-500">CRO, CFO e portais</span></div>
                    </button>
                </div>
            </section>
            
            <!-- Manual (Fixo, mas usa viewer) -->
            <section class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden relative">
                <div class="p-5 flex flex-col md:flex-row items-center md:items-start gap-4">
                    <div class="bg-primary/10 p-3 rounded-xl shrink-0"><i data-lucide="shield-check" class="w-8 h-8 text-primary"></i></div>
                    <div class="flex-grow text-center md:text-left">
                        <h3 class="text-lg font-bold text-gray-900 mb-1">Manual de Biossegurança</h3>
                        <p class="text-sm text-gray-600 mb-4">Normas, esterilização e EPIs.</p>
                        <button onclick="openPost(null, {id:'manual', title:'Biossegurança', category:'Manual', content:'<p>Conteúdo do Manual...</p>'})" class="w-full md:w-auto inline-flex justify-center items-center gap-2 bg-primary hover:bg-secondary text-white font-medium py-3 px-6 rounded-lg transition-colors shadow-sm active:opacity-90">
                            <span>Acessar Manual</span>
                            <i data-lucide="external-link" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- ================= VIEW: PÁGINA DINÂMICA (ESPECIALIDADES/RECURSOS) ================= -->
        <div id="view-dynamic-page" class="view-section space-y-4">
            <!-- Header da Página -->
            <div class="flex items-center gap-3 mb-2 bg-white p-3 rounded-lg shadow-sm border border-gray-100">
                <div class="p-2 bg-blue-50 rounded-lg shrink-0"><i data-lucide="bookmark" class="w-6 h-6 text-primary"></i></div>
                <div><h2 id="page-title" class="text-xl font-bold text-gray-900 leading-tight">Título da Página</h2><p class="text-gray-500 text-xs">Conteúdo da seção</p></div>
                <!-- Admin: Gerenciar Abas -->
                <button onclick="openTabsManager()" id="btn-manage-tabs" class="ml-auto text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1.5 rounded-lg hidden flex items-center gap-1"><i data-lucide="settings" class="w-3 h-3"></i> Abas</button>
            </div>

            <!-- Abas Dinâmicas -->
            <div id="dynamic-tabs" class="bg-white rounded-xl shadow-sm border border-gray-200 flex overflow-x-auto scrollbar-hide">
                <!-- Inserido via JS -->
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6 min-h-[400px] mt-2">
                <!-- Conteúdo da Aba Ativa (Lista de Botões) -->
                <div id="tab-content-area" class="space-y-3">
                    <!-- Botões inseridos via JS -->
                </div>

                <!-- Botão Adicionar Item (Admin) -->
                <div id="page-admin-actions" class="mt-4 pt-4 border-t border-gray-100 hidden">
                     <button onclick="createNewItem()" class="w-full border-2 border-dashed border-gray-300 rounded-xl p-3 text-gray-500 hover:border-primary hover:text-primary transition flex items-center justify-center gap-2 text-sm font-medium">
                        <i data-lucide="plus" class="w-4 h-4"></i> Adicionar Novo Botão/Item
                     </button>
                </div>
            </div>
        </div>

        <!-- ================= VIEW: BLOG GLOBAL ================= -->
        <div id="view-blog" class="view-section space-y-6">
            <div class="flex flex-col gap-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-900">Protocolos Clínicos</h2>
                    <button id="btn-new-protocol" onclick="openEditor(null, '', 'Geral', '', true)" class="hidden bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 shadow-sm"><i data-lucide="plus" class="w-4 h-4"></i> Novo</button>
                </div>
                <div class="relative"><i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i><input type="text" placeholder="Buscar..." class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"></div>
                <div id="blog-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
        </div>

        <!-- ================= VIEW: LEITOR DE CONTEÚDO ================= -->
        <div id="view-post" class="view-section">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden min-h-[60vh]">
                    <div class="bg-gray-50 border-b border-gray-100 p-6 flex justify-between items-start">
                        <div><span id="post-category" class="inline-block px-2 py-1 rounded-md bg-blue-100 text-blue-700 text-xs font-bold uppercase mb-2">Categoria</span><h2 id="post-title" class="text-2xl font-bold text-gray-900 leading-tight">Título</h2></div>
                        <button id="btn-edit-post" class="hidden text-gray-500 hover:text-primary p-2"><i data-lucide="edit-3" class="w-5 h-5"></i></button>
                    </div>
                    <div id="post-content" class="p-8 rich-text editor-paper" style="box-shadow: none; padding: 2rem;"></div>
                </div>
            </div>
        </div>

        <!-- ================= VIEW: EDITOR (ADMIN) ================= -->
        <div id="view-editor" class="view-section">
            <div class="max-w-4xl mx-auto">
                <form id="editor-form" onsubmit="saveItem(event)" class="space-y-4">
                    <input type="hidden" id="edit-id">
                    <input type="hidden" id="edit-page-id"> <!-- ID da página pai (ex: dentistica) -->
                    <input type="hidden" id="edit-tab-id"> <!-- ID da aba pai (ex: prontuario) -->
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Título do Botão</label><input type="text" id="edit-title" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Subtítulo / Resumo</label><input type="text" id="edit-summary" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none"></div>
                    </div>
                    
                    <!-- Toolbar -->
                    <div class="editor-toolbar rounded-t-lg border border-gray-300 border-b-0 bg-gray-50">
                        <button type="button" onclick="execCmd('bold')" class="toolbar-btn font-bold">B</button>
                        <button type="button" onclick="execCmd('italic')" class="toolbar-btn italic">I</button>
                        <div class="w-px h-6 bg-gray-300 mx-2"></div>
                        <button type="button" onclick="execCmd('insertUnorderedList')" class="toolbar-btn"><i data-lucide="list" class="w-4 h-4"></i></button>
                        <button type="button" onclick="execCmd('insertOrderedList')" class="toolbar-btn"><i data-lucide="list-ordered" class="w-4 h-4"></i></button>
                        <div class="w-px h-6 bg-gray-300 mx-2"></div>
                        <button type="button" onclick="execCmd('outdent')" class="toolbar-btn"><i data-lucide="outdent" class="w-4 h-4"></i></button>
                        <button type="button" onclick="execCmd('indent')" class="toolbar-btn"><i data-lucide="indent" class="w-4 h-4"></i></button>
                    </div>
                    
                    <div id="editor-content" class="editor-paper rich-text rounded-b-lg border border-gray-300" contenteditable="true" placeholder="Conteúdo..."></div>

                    <div class="flex gap-3 pt-4 sticky bottom-0 bg-gray-50 p-4 border-t border-gray-200 z-50">
                        <button type="button" onclick="deleteItem()" id="btn-delete" class="px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 hidden text-sm font-medium">Excluir</button>
                        <div class="flex-grow"></div>
                        <button type="button" onclick="window.history.back()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-white text-sm font-medium">Cancelar</button>
                        <button type="submit" id="btn-save" class="px-6 py-2 bg-primary hover:bg-secondary text-white rounded-lg shadow-md flex items-center gap-2 text-sm font-medium">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ================= VIEW: GERENCIADOR DE ABAS ================= -->
        <div id="modal-tabs" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm hidden p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Gerenciar Abas</h3>
                <div id="tabs-list-edit" class="space-y-2 mb-4 max-h-60 overflow-y-auto"></div>
                <div class="flex gap-2">
                    <input type="text" id="new-tab-name" placeholder="Nome da nova aba" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm">
                    <button onclick="addNewTab()" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700"><i data-lucide="plus" class="w-4 h-4"></i></button>
                </div>
                <button onclick="document.getElementById('modal-tabs').classList.add('hidden')" class="w-full mt-4 py-2 border border-gray-300 rounded-lg text-sm">Fechar</button>
            </div>
        </div>

    </main>

    <!-- Footer & Admin -->
    <footer class="bg-white border-t border-gray-200 mt-auto"><div class="max-w-5xl mx-auto px-4 py-8"><div class="flex flex-col items-center gap-6"><button onclick="toggleAdmin()" class="text-xs text-gray-400 hover:text-gray-600 flex items-center gap-1"><i data-lucide="lock" class="w-3 h-3"></i> Admin</button><div class="w-full h-px bg-gray-100"></div><div class="flex items-center gap-6 opacity-80 grayscale hover:grayscale-0"><div class="flex flex-col items-center gap-1"><div class="w-10 h-10 rounded-full bg-red-800 flex items-center justify-center text-white border-2 border-red-900"><i data-lucide="activity" class="w-5 h-5"></i></div><span class="text-[8px] font-bold text-red-900 uppercase">Odonto</span></div><div class="w-px h-8 bg-gray-300"></div><div class="flex items-center gap-2"><div class="w-8 h-10 bg-blue-900 rounded-b-full rounded-t-sm flex items-center justify-center text-white border-2 border-yellow-400 relative overflow-hidden"><span class="text-[8px] font-bold z-10">UFC</span><div class="absolute bottom-0 w-full h-1/2 bg-yellow-400/20 rounded-t-full"></div></div><div class="flex flex-col"><span class="text-[8px] font-bold text-gray-800 uppercase leading-none">Univ.</span><span class="text-[8px] font-bold text-gray-800 uppercase leading-none my-0.5">Federal</span><span class="text-[8px] font-bold text-gray-800 uppercase leading-none">Ceará</span></div></div></div></div><div class="text-center pt-6"><p class="text-[10px] text-gray-400">&copy; 2024 Guia Clínico</p></div></div></footer>

    <div id="admin-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 hidden"><div class="bg-white rounded-2xl p-6"><h3 class="text-lg font-bold mb-4">Acesso</h3><input type="password" id="admin-pass" placeholder="Senha" class="w-full p-3 mb-4 border rounded-lg"><div class="flex gap-2"><button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="flex-1 py-2 text-gray-600 border rounded-lg">Cancelar</button><button onclick="checkAdmin()" class="flex-1 py-2 bg-primary text-white rounded-lg">Entrar</button></div></div></div>

    <!-- Scripts -->
    <script>
        const firebaseConfig = { apiKey: "AIzaSyCtPyXA4TJMvxeX3vNdelzvADQTyzVRCfw", authDomain: "guia-clinico-odonto.firebaseapp.com", projectId: "guia-clinico-odonto", storageBucket: "guia-clinico-odonto.firebasestorage.app", messagingSenderId: "734059654891", appId: "1:734059654891:web:a0f4168725066b054d58ae", measurementId: "G-5287NREP2D" };
        let db; let isFirebaseActive = false;
        try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); isFirebaseActive = true; } catch(e) { console.error(e); }
        
        lucide.createIcons();
        let isAdmin = false;
        let currentPageId = '';
        let currentTabId = '';

        // DADOS ESTRUTURAIS (Simulando DB NoSQL)
        // Estrutura: db.collection('tabs') e db.collection('items')
        let localTabs = [
            { id: 'tab-prontuario', pageId: 'dentistica', title: 'Prontuário', order: 1 },
            { id: 'tab-materiais', pageId: 'dentistica', title: 'Materiais', order: 2 },
            { id: 'tab-geral-presc', pageId: 'prescricoes', title: 'Geral', order: 1 }
        ];
        let localItems = [
            { id: 'item1', tabId: 'tab-prontuario', title: 'Siglas', summary: 'Abreviações', icon: 'type', content: '...' },
            { id: 'item2', tabId: 'tab-prontuario', title: 'Exemplos', summary: 'Preenchimento', icon: 'file-check', content: '...' },
            { id: 'item3', tabId: 'tab-materiais', title: 'Lista Geral', summary: 'Checklist', icon: 'hammer', content: '...' }
        ];

        // --- SISTEMA DE PÁGINAS DINÂMICAS ---
        async function openDynamicPage(pageId, pageTitle) {
            currentPageId = pageId;
            document.getElementById('page-title').textContent = pageTitle;
            navigateTo('dynamic-page');
            
            // Carrega Abas
            await renderTabs(pageId);
        }

        async function renderTabs(pageId) {
            const tabsContainer = document.getElementById('dynamic-tabs');
            tabsContainer.innerHTML = '';
            
            let tabs = [];
            if(isFirebaseActive) {
                const q = await db.collection('tabs').where('pageId', '==', pageId).orderBy('order').get();
                tabs = q.docs.map(d => ({id: d.id, ...d.data()}));
            } else {
                tabs = localTabs.filter(t => t.pageId === pageId).sort((a,b) => a.order - b.order);
            }

            if(tabs.length === 0 && isAdmin) {
                 // Cria aba default se não houver
                 if(!isFirebaseActive) localTabs.push({id: `tab-${Date.now()}`, pageId: pageId, title: 'Geral', order: 1});
                 renderTabs(pageId); return;
            }

            tabs.forEach((tab, index) => {
                const btn = document.createElement('button');
                btn.className = `tab-btn flex-1 ${index === 0 ? 'active' : ''}`;
                btn.textContent = tab.title;
                btn.onclick = (e) => selectTab(e, tab.id);
                tabsContainer.appendChild(btn);
                if(index === 0) loadTabContent(tab.id); // Carrega a primeira
            });
            
            document.getElementById('btn-manage-tabs').classList.toggle('hidden', !isAdmin);
        }

        function selectTab(e, tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            loadTabContent(tabId);
        }

        async function loadTabContent(tabId) {
            currentTabId = tabId;
            const contentArea = document.getElementById('tab-content-area');
            contentArea.innerHTML = '<div class="flex justify-center p-4"><div class="spinner"></div></div>';
            
            let items = [];
            if(isFirebaseActive) {
                const q = await db.collection('items').where('tabId', '==', tabId).get();
                items = q.docs.map(d => ({id: d.id, ...d.data()}));
            } else {
                items = localItems.filter(i => i.tabId === tabId);
            }
            
            contentArea.innerHTML = '';
            
            items.forEach(item => {
                const btn = document.createElement('div');
                btn.className = "w-full p-4 border border-gray-200 rounded-xl hover:border-primary hover:bg-blue-50 transition flex items-center gap-4 text-left cursor-pointer group";
                btn.onclick = () => openPost(item);
                btn.innerHTML = `
                    <div class="p-3 bg-blue-100 rounded-full text-primary shrink-0"><i data-lucide="${item.icon || 'file-text'}" class="w-5 h-5"></i></div>
                    <div class="flex-grow"><span class="block font-semibold text-gray-800">${item.title}</span><span class="text-xs text-gray-500">${item.summary || ''}</span></div>
                    <div class="flex gap-2">
                        ${isAdmin ? `<span onclick="event.stopPropagation(); openEditor('${item.id}', '${item.title}', '${item.summary}', false)" class="text-gray-400 hover:text-blue-600 p-1"><i data-lucide="edit-3" class="w-4 h-4"></i></span>` : ''}
                        <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-gray-300"></i>
                    </div>
                `;
                contentArea.appendChild(btn);
            });
            
            lucide.createIcons();
            document.getElementById('page-admin-actions').classList.toggle('hidden', !isAdmin);
        }

        // --- GESTÃO DE ABAS (ADMIN) ---
        function openTabsManager() {
            const list = document.getElementById('tabs-list-edit');
            list.innerHTML = '';
            // Pega abas atuais (da memória ou recarrega) - Simplificado usando a view atual
            // Idealmente faria nova query
            let tabs = isFirebaseActive ? [] : localTabs.filter(t => t.pageId === currentPageId); 
            // Mock para firebase no frontend simples (assumindo que renderTabs já rodou)
            
            // Renderiza lista simples
            const container = document.getElementById('dynamic-tabs');
            Array.from(container.children).forEach(btn => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center bg-gray-50 p-2 rounded";
                div.innerHTML = `<span>${btn.textContent}</span> <button class="text-red-500 text-xs">X</button>`; 
                // Implementação real exigiria IDs.
                list.appendChild(div);
            });

            document.getElementById('modal-tabs').classList.remove('hidden');
        }
        
        async function addNewTab() {
            const name = document.getElementById('new-tab-name').value;
            if(!name) return;
            
            const newTab = { pageId: currentPageId, title: name, order: 99 }; // Order simplificado
            if(isFirebaseActive) await db.collection('tabs').add(newTab);
            else localTabs.push({id: `tab-${Date.now()}`, ...newTab});
            
            document.getElementById('new-tab-name').value = '';
            document.getElementById('modal-tabs').classList.add('hidden');
            renderTabs(currentPageId);
        }

        // --- EDITOR & ITEMS ---
        function createNewItem() {
            openEditor(null, '', '', true); // Novo item
        }

        function openEditor(id, title, summary, isNew = false) {
            document.getElementById('edit-id').value = id || '';
            document.getElementById('edit-page-id').value = currentPageId;
            document.getElementById('edit-tab-id').value = currentTabId;
            document.getElementById('edit-title').value = title || '';
            document.getElementById('edit-summary').value = summary || '';
            
            if(id && !isNew) {
                // Carregar conteúdo
                const item = isFirebaseActive ? null : localItems.find(i => i.id === id); // Mock
                document.getElementById('editor-content').innerHTML = item ? item.content : '';
                document.getElementById('btn-delete').classList.remove('hidden');
                 if(isFirebaseActive) {
                    db.collection('items').doc(id).get().then(doc => {
                        if(doc.exists) document.getElementById('editor-content').innerHTML = doc.data().content;
                    });
                }
            } else {
                document.getElementById('editor-content').innerHTML = '';
                document.getElementById('btn-delete').classList.add('hidden');
            }
            navigateTo('editor');
        }

        async function saveItem(e) {
            e.preventDefault();
            const id = document.getElementById('edit-id').value;
            const data = {
                title: document.getElementById('edit-title').value,
                summary: document.getElementById('edit-summary').value,
                content: document.getElementById('editor-content').innerHTML,
                pageId: document.getElementById('edit-page-id').value,
                tabId: document.getElementById('edit-tab-id').value,
                icon: 'file-text' // Default icon
            };
            
            if(isFirebaseActive) {
                if(id) await db.collection('items').doc(id).update(data);
                else await db.collection('items').add(data);
            } else {
                if(id) { 
                    const idx = localItems.findIndex(i => i.id === id);
                    if(idx > -1) localItems[idx] = { id, ...data };
                } else {
                    localItems.push({ id: `item-${Date.now()}`, ...data });
                }
            }
            window.history.back();
        }
        
        async function deleteItem() {
            if(!confirm("Excluir item?")) return;
            const id = document.getElementById('edit-id').value;
            if(isFirebaseActive) await db.collection('items').doc(id).delete();
            else localItems = localItems.filter(i => i.id !== id);
            window.history.back();
        }

        // --- FUNÇÕES UTILITÁRIAS ---
        function execCmd(cmd, val=null) { document.execCommand(cmd, false, val); }
        document.getElementById('editor-content').addEventListener('paste', (e) => {
            e.preventDefault();
            document.execCommand('insertText', false, (e.clipboardData || window.clipboardData).getData('text/plain'));
        });

        function navigateTo(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewId}`).classList.add('active');
            window.scrollTo(0, 0);
            const backBtn = document.getElementById('back-btn');
            if (viewId === 'home') backBtn.classList.add('hidden');
            else backBtn.classList.remove('hidden');
            
            if(viewId === 'blog') renderBlog(); // Re-render blog se necessário
        }
        
        function openPost(item) {
             document.getElementById('post-title').textContent = item.title;
             document.getElementById('post-category').textContent = item.summary || 'Detalhes';
             document.getElementById('post-content').innerHTML = item.content;
             navigateTo('post');
             // Botão de editar no post view
             const btn = document.getElementById('btn-edit-post');
             btn.classList.toggle('hidden', !isAdmin);
             btn.onclick = () => openEditor(item.id, item.title, item.summary);
        }

        function toggleAdmin() {
            if(isAdmin) { isAdmin = false; document.getElementById('admin-badge').classList.add('hidden'); navigateTo('home'); }
            else document.getElementById('admin-modal').classList.remove('hidden');
        }
        function checkAdmin() {
            if(document.getElementById('admin-pass').value === 'admin') {
                isAdmin = true; document.getElementById('admin-modal').classList.add('hidden');
                document.getElementById('admin-badge').classList.remove('hidden');
                // Refresh current view if needed
                if(document.getElementById('view-dynamic-page').classList.contains('active')) renderTabs(currentPageId);
            } else alert("Senha incorreta");
        }

        lucide.createIcons();
    </script>
</body>
</html>
